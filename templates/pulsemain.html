<head>
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap");
    </style>
    <script src="/common.js"></script>
    <link rel="stylesheet" href="/style.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Holy Hen has Acquired Sight</title>
</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
    async function getData() {
        // Nexus
        const response = await fetch("/getnexusdata");
        let data = await response.json();
        document.getElementById("match").innerHTML = data["nextMatch"]
        qt = document.getElementById("queuetime")
        qt.innerHTML = data["queueTime"]
        if (data["color"] == "green") qt.style.color = "green"
        else if (data["color"] == "yellow") qt.style.color = "orange"
        else if (data["color"] == "red") qt.style.color = "red"
        let ann = data["announcements"]
        for (let i =0; i < ann.length; i++) {
            if (i == 3) break
            let card = String("c"+(i+1))
            document.getElementById(card+"team").innerHTML = ann[i]["requestedByTeam"]
            document.getElementById(card+"announcement").innerHTML = ann[i]["announcement"]
            let time = new Date(ann[i]["postedTime"]).toLocaleTimeString("en-US");
            document.getElementById(card+"time").innerHTML = time
            if (ann[i]["postedTime"] == "") document.getElementById(card+"time").innerHTML = ""
            if (ann[i]["announcement"] == 'No Announcements at this time.' || ann[i]["announcement"] == "") break
        }
        document.getElementById("t1task").innerHTML = data["tasks"][0]["task"]
        document.getElementById("t1time").innerHTML = data["tasks"][0]["time"]

        //TBA

    }
    async function getStatBotData() {
        console.log("Stat bot data");
        const response = await fetch("/getstatbotdata");
        let data = await response.json();
        stats.innerHTML =
            "Total EPA: " +
            data["epa_total"] +
            " | Wins: " +
            data["wins"] +
            " | Losses: " +
            data["losses"];
    }
    async function getFunFact() {
        console.log("fun fact");
        const response = await fetch("/jsonrequest");
        let data = await response.json();
        if (data[0].length > 500) {
            console.log("too long: " + data[0].length);
        } else {
            fact.innerHTML = data[0];
        }
    }
    getData();
    // getStatBotData();
    // getFunFact()
    setInterval(everySeccond, 1000);
    function everySeccond() {
        getTime();
        getData();
    }
    setInterval(every30s, 30000);
    function every30s() {
        // getStatBotData();
    }
</script>
<body onclick="openFullscreen()" onload="getTime()" id="body">
    <div id="big" class="element">
        live stream
    </div>
    <div id="queue" class="element">
        <h2 id="match" class="inner">Now Queuing (QM3)</h2>
        <h1 id="queuetime" class="inner">21:32</h1>
        <h3 id="time" class="inner">3:40 PM</h3>
    </div>
    <div id="schedule" class="element">
        match schedule
    </div>
    <div id="tasks" class="element">
        <div class="task">
            <h2 class="task" id="t1task">placeholder</h2>
            <h4 class="time" id="t1time">placeholder</h4>
        </div>
        <div class="task">
            <h2 class="task" id="t2task">placeholder</h2>
            <h4 class="time" id="t2time">placeholder</h4>
        </div>
        <div class="task">
            <h2 class="task" id="t3task">placeholder</h2>
            <h4 class="time" id="t3time">placeholder</h4>
        </div>
    </div>
    <div id="announcements" class="element">
        <div class="card" id="card1">
            <h3 class="team" id="c1team"></h3>
            <h2 class="announcement" id="c1announcement"></h2>
            <h4 class="time" id="c1time"></h4>
        </div>
        <div class="card" id="card2">
            <h3 class="team" id="c2team"></h3>
            <h2 class="announcement" id="c2announcement"></h2>
            <h4 class="time" id="c2time"></h4>
        </div>
        <div class="card" id="card3">
            <h3 class="team" id="c3team"></h3>
            <h2 class="announcement" id="c3announcement"></h2>
            <h4 class="time" id="c3time"></h4>
        </div>
    </div>

</body>
<style>
    .card {
        border: solid 2px #f6b14b;
        text-align: center;
        font-size: 1.5rem;
        display: grid;
        grid-template-areas: 
        "a . c"
        " b b b";
    }
    .task {
        border: solid 2px #f6b14b;
        text-align: center;
        font-size: 1.5rem;
        display: grid;
        grid-template-areas: 
        ". . c"
        " b b b";
    }
    .team, .announcement, .time {
        padding: 0;
        margin: 0;
        line-height: 0.5;
        transform: translateY(50%);
    }
    .team {
        grid-area: a;
        font-size: 2rem;
    }
    .announcement, .task {
        grid-area: b;
        font-size: 2.3rem;
    }
    .time {
        font-size: 2rem;
        grid-area: c;
    }
    .element {
        display: grid;
        border: solid 5px #f6b14b;
        color: white;
    }
    .inner {
        padding: 2%;
        line-height: 0;
    }

    h1 {
        color: #f6b14b;
    }
    h2 {
        color: white;
    }
    h3 {
        color: #1c1c1c;
        -webkit-text-stroke: 2px white;
    }
    h4 {
        color: #4c4c4c;
    }
    body {
        display: grid;
        grid-template-areas: 
        "a a b"
        "a a b"
        "c d e";
        grid-gap: 5px;
        overflow: hidden;
    }
    #big {
        grid-area: a;
    }
    #queue {
        grid-area: e;
        #match {
            font-size: 3rem;
            line-height: 0;
            transform: translate(0, 10px);
        }
        #time {
            font-size: 3rem;
            line-height: 0;
            transform: translate(0, 5rem);
        }
        #queuetime{
            font-size: 10rem;
            margin: auto;
            text-align: center;
        }
    }
    #tasks {
        grid-area: d;
        overflow-y: auto;
    }
    #announcements {
        grid-area: c;
        overflow-y: auto;
    }
    #schedule {
        grid-area: b;
        overflow-y: auto;
    }
</style>
