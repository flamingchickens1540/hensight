<head>
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap");
    </style>
    <script src="/common.js"></script>
    <link rel="stylesheet" href="/style.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
    let idle_secconds = 0;
    let fact_secconds = 0;
    function incrementSeconds() {
        idle_secconds++;
        // fact_secconds++
        // console.log('idle for:',idle_secconds, 'seccond')
        // console.log('fact secconds: ',fact_secconds)
        if (idle_secconds >= 120) {
            // window.location.href = "/";
        }
        // if (fact_secconds >= 10) {
        //     fact_secconds = 0
        //     getFunFact()
        // }
    }

    window.addEventListener("touchstart", () => {
        idle_secconds = 0;
        console.log("reset");
    });

    async function getNexusData() {
        const response = await fetch("/getnexusdata");
        let data = await response.json();
        console.log("Nexus data");
        upmatch.innerHTML = data[0];
        if (data[1] != "") {
            announcements.innerHTML = data[1];
        } else {
            announcements.innerHTML = "There are no announcements at this time";
        }
        if (data[2] != "") {
            requests.innerHTML = data[2];
        } else {
            requests.innerHTML = "There are no part requests at this time";
        }
        if (data[3] != "") {
            nextup.innerHTML = "Now Queuing: " + data[3];
        } else {
            nextup.innerHTML = "There are currently no matches queuing";
        }
    }
    async function getStatBotData() {
        console.log("Stat bot data");
        const response = await fetch("/getstatbotdata");
        let data = await response.json();
        stats.innerHTML =
            "Total EPA: " +
            data[0] +
            " | Wins: " +
            data[1] +
            " | Losses: " +
            data[2];
    }
    async function getFunFact() {
        console.log("fun fact");
        const response = await fetch("/jsonrequest");
        let data = await response.json();
        if (data[0].length > 500) {
            console.log("too long: " + data[0].length);
        } else {
            fact.innerHTML = data[0];
        }
    }
    getNexusData();
    getStatBotData();
    // getFunFact()
    setInterval(everySeccond, 1000);
    function everySeccond() {
        incrementSeconds();
        getTime();
    }
    setInterval(every30s, 30000);
    function every30s() {
        getNexusData();
        getStatBotData();
    }
</script>
<style>
    #main-info-thingy {
        justify-items: space-between;
        flex-grow: 10;
        padding-block: var(--gap);
    }
    button {
        font-size: 3rem;
        font-weight: 700;
        width: 100%;
    }
    h1 {
        font-size: 5rem !important;
    }
    #header {
        justify-content: space-around;
        width: 100%;
    }
    footer {
        width: 100%;
        justify-content: space-between !important;
    }
    footer a {
        flex-grow: 1;
    }
    footer > a:not(#main-menu) > button::before,
    #main-info-thingy > button::before {
        background-image: none;
        background: #ffc145;
    }
</style>
<body onclick="openFullscreen()" onload="getTime()" class="center-col">
    <div id="header" class="flex-row-auto">
        <h1 id="title">Hensight</h1>
        <h1 id="time"></h1>
    </div>
    <div id="main-info-thingy" class="center-col">
        <button id="upmatch"></button>
        <button id="nextup"></button>
        <button id="announcements">There are currently no announcements</button>
        <button id="requests">There are currently no part requests</button>
        <button id="stats">Loading...</button>
        <!-- <div class="inner-div grid col-start-1 col-end-5 row-start-6" id="fact"></div> -->
        <footer class="flex-row-auto">
            <a href="/pulse_schedule" style="font-size: 2.5rem"
                ><button>Schedule</button></a
            >
            <a id="main-menu" href="/menu" style="font-size: 2.5rem"
                ><button>Main Menu</button></a
            >
            <a href="/pulse_ranking" style="font-size: 2.5rem"
                ><button>Ranking</button></a
            >
        </footer>
    </div>
</body>
